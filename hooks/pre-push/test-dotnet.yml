templates:
  build_config: Release

pre-push:
  parallel: true
  jobs:
    - name: test-dotnet
      glob: "**/*.{cs,csproj,sln,slnx}"
      group:
        piped: true
        jobs:
          - name: build-solution
            run: dotnet build -c {build_config}
          - name: run-tests
            skip:
              - run: |
                  HAS_TESTS=$(
                    dotnet test --list-tests --no-build -c {build_config} >/dev/null 2>&1
                    echo $?
                  )
                  test "$HAS_TESTS" -ne 0
            run: dotnet test --no-build -c {build_config}
